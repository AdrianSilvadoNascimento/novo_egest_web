<!-- Header gradient -->
<div class="relative bg-gradient-to-r from-[#3377bc] to-[#2a5f9a] p-6 text-white">
  <div class="text-center">
    <span class="text-sm px-2 rounded-md bg-white/20 text-white border border-white/30 mb-3">Movimentação</span>
    <div class="text-3xl text-white font-semibold font-[Lora]">Nova movimentação de estoque</div>
  </div>
  <button (click)="dialogRef.close()" class="absolute top-4 right-4 text-white/80 hover:text-white transition-colors">
    <mat-icon>close</mat-icon>
  </button>
</div>

<mat-dialog-content>
  <form [formGroup]="movementationForm" (ngSubmit)="onSubmit()">
    <!-- Tipo de Movimentação -->
    <div class="px-6 pb-6">
      <div class="grid grid-cols-5 gap-3">
        @for (movement of movementTypes; track movement.type) {
          <div 
            class="cursor-pointer border rounded-xl p-4 text-center transition-all duration-200 hover:shadow-sm"
            [class]="movement.color"
            (click)="selectMovementType(movement.type)"
          >
            <div class="flex justify-center mb-2">
              <lucide-icon [img]="movement.icon" class="w-8 h-8"></lucide-icon>
            </div>
            <div class="text-sm font-medium mb-1">{{ movement.label }}</div>
            <div class="text-xs opacity-75 leading-tight">{{ movement.description }}</div>
          </div>
        }
      </div>
    </div>

    <!-- Detalhes -->
    <mat-card class="p-6 font-[Lora] mb-6">
      <div class="text-lg text-gray-900 mb-4">Detalhes</div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Coluna Esquerda -->
        <div class="space-y-4">
          <!-- Quantidade -->
          <div>
            <label class="block text-sm text-gray-700 mb-2">Quantidade</label>
            <div class="flex items-center border rounded-lg">
              <button 
                type="button"
                class="p-3 hover:bg-gray-50 border-r"
                (click)="decreaseQuantity()"
              >
                <span class="text-lg">−</span>
              </button>
              <input 
                type="number"
                formControlName="quantity"
                class="flex-1 px-4 py-3 text-center border-0 focus:ring-0 focus:outline-none"
                min="1"
              >
              <button 
                type="button"
                class="p-3 hover:bg-gray-50 border-l"
                (click)="increaseQuantity()"
              >
                <span class="text-lg">+</span>
              </button>
            </div>
          </div>

          <!-- Preço Unitário -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Preço Unitário</label>
            <div class="relative">
              <span class="absolute left-3 top-3 text-gray-500">R$</span>
              <input 
                type="number"
                formControlName="unit_price"
                class="w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                step="0.01"
                min="0"
              >
            </div>
          </div>
        </div>

        <!-- Coluna Direita -->
        <div class="space-y-4">
          <!-- Valor Total -->
          <div class="md:mb-9">
            <label class="block text-sm font-medium text-gray-700 mb-2">Valor Total:</label>
            <div class="text-2xl font-bold text-blue-600">
              {{ movementationForm.get('total_value')?.value | currency:'BRL':'symbol':'1.2-2' }}
            </div>
          </div>

          <!-- Data da Movimentação -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Data da Movimentação</label>
            <input 
              type="date"
              formControlName="movement_date"
              class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              [value]="movementationForm.get('movement_date')?.value | date:'yyyy-MM-dd'"
            >
          </div>
        </div>
      </div>
    </mat-card>

    <!-- Informações Adicionais -->
    <mat-card class="p-6 font-[Lora]">
      <div class="text-lg text-gray-900 mb-4">Informações Adicionais</div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Motivo -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Motivo *</label>
          <mat-form-field appearance="outline" class="w-full">
            <mat-select formControlName="description" placeholder="Selecione o motivo">
              @for (motivo of motivos; track motivo) {
                <mat-option [value]="motivo">{{ motivo }}</mat-option>
              }
              <mat-option value="custom">Outro (especificar)</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Fornecedor -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Fornecedor</label>
          <input 
            type="text"
            formControlName="supplier"
            placeholder="Nome do fornecedor"
            class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          >
        </div>

        <!-- Referência/Documento -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Referência/Documento</label>
          <input 
            type="text"
            formControlName="reference_document"
            placeholder="Nº da nota, pedido, etc."
            class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          >
        </div>

        <!-- Responsável -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Responsável</label>
          <input 
            type="text"
            [value]="getCurrentUserName()"
            disabled
            class="w-full px-4 py-3 border rounded-lg bg-gray-50 text-gray-500"
          >
        </div>
      </div>

      <!-- Observações -->
      <div class="mt-4">
        <label class="block text-sm font-medium text-gray-700 mb-2">Observações</label>
        <textarea 
          formControlName="observations"
          rows="3"
          placeholder="Informações adicionais sobre a movimentação..."
          class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none"
        ></textarea>
      </div>
    </mat-card>

    <hr class="my-6">

    <!-- Footer/Actions -->
    <div class="flex flex-row justify-end gap-2">
      <!-- Botões -->
      <button (click)="onCancel()" class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors">
        Cancelar
      </button>
      <button
        type="submit"
        [disabled]="!isFormValid()"
        class="bg-[#3377bc] text-white inline-flex gap-2 items-center px-4 py-2 text-sm font-medium rounded-lg hover:bg-blue-600 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
        Registrar Movimentação
      </button>
    </div>
  </form>
</mat-dialog-content>
